<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="../../../res/layui/css/layui.css" media="all">
		<link rel="stylesheet" href="../../../res/css/common/font-awesome.min.css" media="all">
		<link rel="stylesheet" href="../../../res/layui-config/css/app.css" media="all">
		<title>总经理审核</title>
	</head>
	<body>
	<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
  <legend>总经理审核</legend>
	</fieldset>
		<div class="kit-table">
				<!-- 操作按钮 -->
		    <div class="kit-table-body">
		        <table id="demo" lay-filter="demo"></table>
		        <script type="text/html" id="barDemo">
		            <a class="layui-btn layui-btn-xs" lay-event="edit">查看订单详情</a>
		            <a class="layui-btn layui-btn-xs" lay-event="detail">审核</a>
		        </script>
		    </div>
		</div>
		
		<!-- 修改页面 -->
		<script type="text/html" id="edit-tpl">
		    <div style="margin:10px">
		        <form class="layui-form" action="" lay-filter="form-edit">
		            <input type="hidden" name="id" value="{{d.user.id}}" />
		            <div class="layui-form-item">
		                <label class="layui-form-label">用户名</label>
		                <div class="layui-input-block">
		                    <input type="text" name="username" required lay-verify="required" value="{{d.user.username}}" placeholder="请输入标题" autocomplete="off" class="layui-input">
		                </div>
		            </div>
		            <div class="layui-form-item">
		                <label class="layui-form-label">密码框</label>
		                <div class="layui-input-inline">
		                    <input type="password" name="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
		                </div>
		                <div class="layui-form-mid layui-word-aux">辅助文字</div>
		            </div>
		            <div class="layui-form-item">
		                <label class="layui-form-label">单选框</label>
		                <div class="layui-input-block">
		                    {{# var woman = d.user.sex === 0?'checked':'';}} {{# var man = d.user.sex === 1?'checked':'';}}
		                    <input type="radio" name="sex" value="男" title="男" {{man}} />
		                    <input type="radio" name="sex" value="女" title="女" {{woman}} />
		                </div>
		            </div>
		            <div class="layui-form-item">
		                <label class="layui-form-label">城市</label>
		                <div class="layui-input-block">
		                    <select name="city" lay-verify="required">
		                      <option value=""></option>
		                      {{# layui.each(d.citys,function(index,item){ }}                      
		                      {{# if(item.id===d.user.city){}}
		                      <option value="{{item.id}}" selected>{{item.name}}</option>
		                      {{#}else{}}
		                      <option value="{{item.id}}">{{item.name}}</option>
		                      {{#};}}
		                      {{# }); }}
		                    </select>
		                </div>
		            </div>
		            <div class="layui-form-item">
		                <label class="layui-form-label">积分</label>
		                <div class="layui-input-block">
		                    <input type="number" name="experience" required lay-verify="required" value="{{d.user.experience}}" placeholder="请输入积分" autocomplete="off" class="layui-input">
		                </div>
		            </div>
		            
		            <div class="layui-form-item">
		                <label class="layui-form-label">职业</label>
		                <div class="layui-input-block">
		                    <select name="classify" lay-verify="required">
		                        <option value=""></option>                        
		                      {{# layui.each(d.classifies,function(index,item){ }}
		                      {{# if(item.id===d.user.classify){}}
		                      <option value="{{item.id}}" selected>{{item.name}}</option>
		                      {{#}else{}}
		                      <option value="{{item.id}}">{{item.name}}</option>
		                      {{#};}}
		                      {{# }); }}
		                    </select>
		                </div>
		            </div>
		            <div class="layui-form-item layui-form-text">
		                <label class="layui-form-label">签名</label>
		                <div class="layui-input-block">
		                    <textarea name="sign" placeholder="请输入个性签名" class="layui-textarea">{{d.user.sign}}</textarea>
		                </div>
		            </div>
		            <div class="layui-form-item" style="display:none;">
		                <div class="layui-input-block">
		                    <button class="layui-btn" lay-submit lay-filter="formEdit">立即提交</button>
		                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
		                </div>
		            </div>
		        </form>
		    </div>
		</script>
		
		<!-- 显示表格 -->
		<script src="../../res/layui/layui.js"></script>
		<script>
		    layui.use(['table'], function() {
		        var table = layui.table,
		            $ = layui.jquery,
		            layer = layui.layer,
		            form = layui.form,
		            laytpl = layui.laytpl;
		        var tableIns = table.render({
		            elem: '#demo',
		            height: 'full', //容器高度
		            url: '../../../audit/showCEO.action',
		            page: true,
		            id: 'demo',
		            cols: [
		            	 [{field: 'audId',title: 'ID', width: 273},
		                {field: 'audFkId',title: '采购单号',width: 175},
		                {field: 'audComtype',title: '厂家',width: 80},
		                {field: 'qcFkId',title: '公司编号',width: 130},
		                {field: 'audTimes',title: '审核时间',width: 170},
		                {field: 'audStates',title: '审核状态',width: 90},
		                {field: 'audIdea',title: '审核意见',width: 150},
		                {field: 'audName',title: '审核人',width: 90},
		                {field: 'audMes',title: '备注',width: 90},
		                {field: 'optimes',title: '操作时间',width: 170},
		                {field: 'oper',title: '操作人',width: 95,sort: true}, 
		                {fixed: 'right',title: '操作',width: 220,align: 'center', toolbar: '#barDemo' }]
		            ],
		            done: function(res, curr, count) {
						
		            },
		            loading: true,
		            //method: 'post'
		        });
						//城市及角色
		        var staticData = {
		            citys: [{id: 0,name: '北京'},
		            	{id: 1,name: '广州'}, 
		            	{id: 2,name: '深圳'}, 
		            	{id: 3,name: '杭州'}],
		            classifies: [{id: 0,name: '词人' }, 
		            	{id: 1,name: '诗人'}, 
		            	{id: 2,name: '作家'}, 
		            	{id: 3,name: '酱油'}]
		        };
		        //监听搜索表单提交
		        form.on('submit(search)', function(data) {
		            console.log(data.field);
		            layer.msg(JSON.stringify(data.field));
		            //带条件查询
		            tableIns.reload({
		                where: data.field
		            });
		            return false;
		        });
		        //监听工具条
		        table.on('tool(demo)', function(obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
		            var data = obj.data; //获得当前行数据
		            var layEvent = obj.event; //获得 lay-event 对应的值
		            var tr = obj.tr; //获得当前行 tr 的DOM对象
		
		            if (layEvent === 'detail') { //审核
		            	
		            	layer.open({
		            		type:2
		            		,title:'审核'
		            		,area: ['600px', '500px']
		            	  ,content: ['auditFrom2.html', 'no']
		            	,success:function(layero, index){
		            		var body = layer.getChildFrame('body', index);
		        	    	 var iframe = window[layero.find('iframe')[0]['name']]; 
		        	    	 var url="../../../audit/findById.action";
		        	    	 var data={"audId":data.audId};
		        	    	 $.ajax({
		        	    		 async:false,
		        	    		 url:url,
		        	    		 data:data,
		        	    		 dataType:"json",
		        	    		 success:function(mes){
		        		    			 iframe.$("#audId").val(mes.audId); 
		        			    		 iframe.$("#audFkId").val(mes.audFkId);
		        			    		 iframe.load();
		        	    		 }
		        	    	 }); 
		            	}
		            	//操作完成执行刷新 
		            	,end:function(index,layero){
		            		location.reload();
		            	}
		            	});
		            	/*var url = "../../audit/auditByaudId.action";  
		            	var data = {"id":data.audId,"state":12,"buyId":data.audFkId};	
		            	$.post(url,data,function(mes){
		            		if(mes.status==1){
		            			alert("审核成功");
		            		}else{
		            			alert("审核失败");
		            		}
		            		
		            	},"json");
		            	console.log(table.checkStatus('demo'));*/
		            } else if (layEvent === 'del') { //不审核
		                layer.confirm('真的删除行么', function(index) {
		                	
		                	var url = "../../../audit/auditByaudId.action";  
			            	var data = {"id":data.audId,"state":11,"buyId":data.audFkId};	
			            	$.post(url,data,function(mes){
			            		if(mes.status==1){
			            			console.log("操作成功");
			            		}else{
			            			console.log("操作失败");
			            		}
			            		
			            	},"json");
		                    layer.close(index);
		                    //向服务端发送删除指令
		                });
		            } else if (layEvent === 'edit') { //查看详情
		                var d = {
		                    user: data,
		                    citys: staticData.citys,
		                    classifies: staticData.classifies
		                };
		                laytpl($('#edit-tpl').html()).render(d, function(html) {
		                    layer.open({
		                        type: 1,
		                        title: '信息',
		                        content: html,
		                        area: ['800px', '450px'],
		                        btn: ['提交', '重置', '取消'],
		                        yes: function(index, layero) {
		                            editIndex = index;
		                            $('form[lay-filter="form-edit"]').find('button[lay-submit]').click();
		                        },
		                        btn2: function(index, layero) {
		                            $('form[lay-filter="form-edit"]').find('button[type="reset"]').click();
		                            return false;
		                        },
		                        success: function() {
		                            form.render(null, 'form-edit');
		                        }
		                    });
		                });
		                //同步更新缓存对应的值
		                // obj.update({
		                //     username: '123',
		                //     title: 'xxx'
		                // });
		            }
		        });
		        form.render(null, 'kit-search-form');
		        $('#kit-search-more').on('click', function() {
		            $('.kit-search-mored').toggle();
		        });
		        var editIndex;
		        form.on('submit(formEdit)', function(data) {
		            layer.msg('formEdit');
		            editIndex && layer.close(editIndex); //关闭弹出层
		            return false;
		        });
		        $('.kit-search-btns').children('a').off('click').on('click', function() {
		            var $that = $(this),
		                action = $that.data('action');
		            switch (action) {
		                case 'add':
		                    var d = {
		                        user: {
		                            sign: '你哈',
		                            city: '',
		                            classify: '',
		                            experience: '',
		                            id: 0,
		                            logins: '',
		                            score: '',
		                            sex: 1,
		                            sign: '',
		                            username: '',
		                            wealth: ''
		                        },
		                        citys: staticData.citys,
		                        classifies: staticData.classifies
		                    };
		                    break;
		                case 'del-bulk':
		                    var d = table.checkStatus('demo');
		                    if (d.data.length === 0) {
		                        layer.msg('请选择要删除的数据');
		                        return;
		                    }
		                    var data = d.data,
		                        names = [],
		                        ids = [];
		                    layui.each(data, function(index, item) {
		                        console.log(item);
		                        names.push(item.username);
		                        ids.push(item.id);
		                    });
		                    layer.msg(names.join(','));
		                    console.log(ids.join(','));
		                    break;
		            }
		        });
		    });
		</script>
	</body>
</html>
